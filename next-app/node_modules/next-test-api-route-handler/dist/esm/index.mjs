import{createRequire as e}from"module";var r,t,o={32:r=>{r.exports=e(import.meta.url)("next/dist/server/api-utils/node.js")}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var t=n[e]={exports:{}};return o[e](t,t.exports,s),t.exports}s.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return s.d(r,{a:r}),r},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(e,o){if(1&o&&(e=this(e)),8&o)return e;if("object"==typeof e&&e){if(4&o&&e.__esModule)return e;if(16&o&&"function"==typeof e.then)return e}var n=Object.create(null);s.r(n);var a={};r=r||[null,t({}),t([]),t(t)];for(var i=2&o&&e;"object"==typeof i&&!~r.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((r=>a[r]=()=>e[r]));return a.default=()=>e,s.d(n,a),n},s.d=(e,r)=>{for(var t in r)s.o(r,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},s.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{s.d(a,{W:()=>y});const r=e(import.meta.url)("node-fetch");var t=s.n(r);const o=e(import.meta.url)("http");var n=s.n(o);const i=e(import.meta.url)("url");var l=s.n(i);const c=e(import.meta.url)("cookie");var u=s.n(c);const{createServer:p}=n(),{parse:d}=l(),{parse:f}=u();let m=null;const v=e=>r=>{var t;return(v.importErrors=null!==(t=v.importErrors)&&void 0!==t?t:[]).push(r),import(e)},h=(e,r,t)=>{if(!e.writableEnded&&e.end(),!t)throw r;t(r)};async function y({rejectOnHandlerError:e,requestPatcher:o,responsePatcher:n,paramsPatcher:a,params:i,url:l,handler:c,test:u}){let y=null,b=null;try{if(!m&&(({apiResolver:m}=await Promise.resolve().then(s.t.bind(s,32,23)).catch(v("next/dist/server/api-utils.js")).catch(v("next/dist/next-server/server/api-utils.js")).catch(v("next-server/dist/server/api-utils.js")).catch((e=>(v.importErrors.push(e),{apiResolver:null})))),!m)){const e=v.importErrors.map((e=>e.message.split(/(?<=')( imported)? from ('|\S)/)[0].split("\nRequire")[0])).join("\n    - ");throw v.importErrors=[],new Error(`next-test-api-route-handler (NTARH) failed to import api-utils.js\n\n  This is usually caused by:\n\n    1. Using npm@<7 and/or node@<15, which doesn't install peer deps automatically (review install instructions)\n    2. NTARH and the version of Next.js you installed are actually incompatible (please submit a bug report)\n\n  Failed import attempts:\n\n    - ${e}`)}y=p(((r,t)=>{try{if("function"!=typeof m)throw new Error("assertion failed unexpectedly: apiResolver was not a function");l&&(r.url=l),o&&o(r),n&&n(t);const s={...d(r.url||"",!0).query,...i};a&&a(s),m(r,t,s,c,void 0,!!e).catch((e=>h(t,e,b)))}catch(e){h(t,e,b)}}));const j=`http://localhost:${await new Promise(((e,r)=>{var t;null===(t=y)||void 0===t||t.listen((()=>{var t;const o=null===(t=y)||void 0===t?void 0:t.address();o&&"string"!=typeof o?e(o.port):r(new Error("assertion failed unexpectedly: server did not return AddressInfo instance"))}))}))}`;await new Promise(((e,o)=>{b=o,u({fetch:async e=>{const o={...e,headers:(n=new r.Headers(null==e?void 0:e.headers),n.has("x-msw-bypass")||n.set("x-msw-bypass","true"),n)};var n;return t()(j,o).then((e=>(Object.defineProperty(e,"cookies",{configurable:!0,enumerable:!0,get:()=>(delete e.cookies,e.cookies=[e.headers.raw()["set-cookie"]||[]].flat().map((e=>Object.entries(f(e)).reduce(((e,[r,t])=>Object.assign(e,{[String(r)]:t,[String(r).toLowerCase()]:t})),{}))),e.cookies)}),e)))}}).then(e,o)}))}finally{var w;null===(w=y)||void 0===w||w.close()}}})();var i=a.W;export{i as testApiHandler};